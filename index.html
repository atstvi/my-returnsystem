<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚˜ì˜ ëŒì•„ì˜¤ëŠ” ì‹œìŠ¤í…œ</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#f7f4ef;--surface:#fff;--border:#ddd8ce;
    --accent:#8b6f47;--accentL:#c4a882;--accentDim:#ede8de;
    --text:#2c2820;--textDim:#6b6055;--textF:#a89e93;
    --green:#5a8a60;--yellow:#8b7040;--red:#a05050;
  }
  body{font-family:system-ui,-apple-system,'Apple SD Gothic Neo',sans-serif;font-weight:300;background:var(--bg);color:var(--text);font-size:15px;min-height:100vh}
  .tab-bar{display:flex;border-bottom:1px solid var(--border);background:var(--surface);position:sticky;top:0;z-index:100;box-shadow:0 1px 4px rgba(0,0,0,.05)}
  .tab-btn{flex:1;padding:14px 4px;background:none;border:none;border-bottom:2px solid transparent;font-family:inherit;font-size:13px;font-weight:300;color:var(--textF);cursor:pointer;transition:all .2s}
  .tab-btn.active{border-bottom-color:var(--accent);color:var(--accent);font-weight:500}
  .inner{max-width:540px;margin:0 auto;padding-bottom:60px}
  .page{display:none}.page.active{display:block}

  .api-banner{background:#fff3cd;border:1px solid #ffc107;border-radius:10px;padding:14px 16px;margin:16px 22px;font-size:13px;color:#856404;line-height:1.8}
  .api-row{display:flex;gap:8px;padding:0 22px 12px}
  .api-inp{flex:1;padding:11px 13px;border:1px solid var(--border);border-radius:8px;font-family:inherit;font-size:13px;background:var(--surface);color:var(--text)}
  .api-inp:focus{outline:none;border-color:var(--accentL)}
  .api-save-btn{padding:11px 16px;background:var(--accent);border:none;color:#fff;font-family:inherit;font-size:13px;border-radius:8px;cursor:pointer;white-space:nowrap}

  .hero{padding:36px 22px 24px;border-bottom:1px solid var(--border)}
  .eyebrow{font-size:11px;letter-spacing:3px;color:var(--accentL);text-transform:uppercase;margin-bottom:12px}
  .hero h1{font-family:Georgia,serif;font-size:24px;font-weight:400;line-height:1.5;margin-bottom:20px}
  .motto{background:var(--accentDim);border-radius:10px;padding:16px 18px;font-size:14px;color:var(--textDim);line-height:2.1}
  .motto strong{color:var(--accent)}
  .sec-lbl{font-size:11px;letter-spacing:3px;color:var(--textF);text-transform:uppercase;padding:22px 22px 10px}
  .phil-list{padding:0 22px;display:flex;flex-direction:column;gap:8px;margin-bottom:20px}
  .phil-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px}
  .phil-tag{font-size:11px;color:var(--accentL);font-weight:500;margin-bottom:3px}
  .phil-title{font-size:14px;font-weight:500;color:var(--text);margin-bottom:4px}
  .phil-body{font-size:13px;color:var(--textDim);line-height:1.8}
  .start-btn{display:block;margin:4px 22px 0;padding:16px;background:var(--accent);border:none;color:#fff;font-family:inherit;font-size:15px;border-radius:10px;cursor:pointer;text-align:center;width:calc(100% - 44px)}

  .q-header{padding:22px 22px 0}
  .prog-row{display:flex;align-items:center;gap:10px;margin-bottom:20px}
  .prog-bar{flex:1;height:3px;background:var(--border);border-radius:2px;overflow:hidden}
  .prog-fill{height:100%;background:var(--accent);transition:width .4s}
  .prog-lbl{font-size:11px;color:var(--textF);white-space:nowrap}
  .q-cat{font-size:11px;color:var(--accentL);letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
  .q-text{font-family:Georgia,serif;font-size:20px;font-weight:400;line-height:1.5;margin-bottom:6px}
  .q-sub{font-size:12px;color:var(--textF);line-height:1.8;margin-bottom:18px}
  .opts{padding:0 22px;display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
  .opt-btn{padding:13px 16px;background:var(--surface);border:1px solid var(--border);color:var(--textDim);font-family:inherit;font-size:14px;font-weight:300;cursor:pointer;border-radius:10px;text-align:left;transition:all .2s}
  .opt-btn.selected{background:var(--accentDim);border-color:var(--accent);color:var(--accent);font-weight:500}
  .ta-wrap{padding:0 22px;margin-bottom:10px}
  textarea{width:100%;background:var(--surface);border:1px solid var(--border);color:var(--text);font-family:inherit;font-size:14px;font-weight:300;padding:13px 15px;resize:none;min-height:100px;border-radius:10px;line-height:1.8}
  textarea:focus{outline:none;border-color:var(--accentL)}
  .insight-box{margin:0 22px 10px;background:var(--accentDim);border-left:3px solid var(--accent);padding:13px 15px;border-radius:0 8px 8px 0}
  .insight-lbl{font-size:10px;letter-spacing:2px;color:var(--accent);text-transform:uppercase;margin-bottom:5px;font-weight:500}
  .insight-txt{font-size:13px;color:var(--textDim);line-height:1.9}
  .ai-load-row{display:flex;align-items:center;gap:10px;margin:0 22px 10px;padding:11px 14px;background:var(--surface);border:1px solid var(--border);border-radius:10px;font-size:13px;color:var(--textF)}
  .spinner{width:14px;height:14px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0}
  .spinner-lg{width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto}
  @keyframes spin{to{transform:rotate(360deg)}}
  .nav-row{display:flex;gap:10px;padding:12px 22px 0}
  .btn-next{flex:1;padding:15px;background:var(--accent);border:none;color:#fff;font-family:inherit;font-size:14px;border-radius:10px;cursor:pointer}
  .btn-next:disabled{opacity:.4;cursor:not-allowed}
  .btn-back{padding:15px 16px;background:var(--surface);border:1px solid var(--border);color:var(--textF);font-family:inherit;font-size:14px;cursor:pointer;border-radius:10px}

  .res-top{padding:32px 22px 18px;border-bottom:1px solid var(--border)}
  .res-top h2{font-family:Georgia,serif;font-size:22px;font-weight:400;margin-bottom:4px}
  .res-time{font-size:12px;color:var(--textF)}
  .res-sec{padding:20px 22px 0}
  .res-sec-t{font-size:11px;letter-spacing:2px;color:var(--textF);text-transform:uppercase;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--border)}
  .s-row{display:flex;align-items:flex-start;gap:10px;padding:10px 12px;background:var(--surface);border-radius:8px;margin-bottom:4px}
  .dot{width:8px;height:8px;border-radius:50%;margin-top:5px;flex-shrink:0}
  .dot.ok{background:var(--green)}.dot.warn{background:var(--yellow)}.dot.bad{background:var(--red)}
  .s-lbl{font-size:11px;color:var(--textF);margin-bottom:2px}
  .s-val{font-size:13px;color:var(--text);line-height:1.7;white-space:pre-wrap}
  .ai-box{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px 18px;font-size:13px;color:var(--textDim);line-height:1.9;white-space:pre-wrap}
  .act-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px;margin-bottom:8px}
  .act-top{display:flex;align-items:flex-start;gap:10px;margin-bottom:5px}
  .act-num{width:22px;height:22px;background:var(--accent);color:#fff;border-radius:50%;font-size:11px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-weight:500;margin-top:2px}
  .act-title{font-size:14px;font-weight:500;color:var(--text);line-height:1.4}
  .act-why{font-size:12px;color:var(--accentL);line-height:1.7;padding-left:32px;margin-top:2px;font-style:italic}
  .act-desc{font-size:12px;color:var(--textDim);line-height:1.8;padding-left:32px;margin-top:4px}
  .memo-save-area{padding:20px 22px 0}
  .memo-lbl{font-size:13px;color:var(--textDim);margin-bottom:10px;line-height:1.7}
  .save-m-btn{padding:10px 16px;background:var(--accentDim);border:1px solid var(--accentL);color:var(--accent);font-family:inherit;font-size:13px;font-weight:500;border-radius:8px;cursor:pointer;margin-top:8px}
  .final-box{margin:18px 22px 0;padding:22px;background:var(--accentDim);border-radius:10px;text-align:center}
  .final-box p{font-family:Georgia,serif;font-size:14px;color:var(--textDim);line-height:2.2}
  .final-box strong{color:var(--accent)}
  .restart-btn{display:block;margin:10px 22px 0;padding:14px;background:transparent;border:1px solid var(--border);color:var(--textF);font-family:inherit;font-size:13px;cursor:pointer;border-radius:10px;text-align:center;width:calc(100% - 44px)}

  .memo-h{padding:26px 22px 16px;border-bottom:1px solid var(--border)}
  .memo-h h2{font-family:Georgia,serif;font-size:20px;font-weight:400;margin-bottom:4px}
  .memo-sub{font-size:12px;color:var(--textF);line-height:1.7}
  .memo-add{padding:16px 22px;border-bottom:1px solid var(--border)}
  .memo-add-btn{padding:10px 16px;background:var(--accent);border:none;color:#fff;font-family:inherit;font-size:13px;border-radius:8px;cursor:pointer;margin-top:8px}
  .memo-list{padding:14px 22px}
  .memo-empty{font-size:13px;color:var(--textF);text-align:center;padding:36px 0;line-height:2}
  .memo-item{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 14px;margin-bottom:8px;position:relative}
  .memo-date{font-size:11px;color:var(--textF);margin-bottom:4px}
  .memo-text{font-size:13px;color:var(--textDim);line-height:1.8;padding-right:24px;white-space:pre-wrap}
  .memo-del{position:absolute;top:10px;right:12px;background:none;border:none;color:var(--textF);font-size:16px;cursor:pointer}
  .toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--text);color:#fff;font-size:13px;padding:10px 20px;border-radius:20px;z-index:999;opacity:0;transition:opacity .3s;pointer-events:none}
  .toast.show{opacity:1}
</style>
</head>
<body>

<div id="apiBanner" class="api-banner" style="display:none">
  âš ï¸ Gemini API í‚¤ë¥¼ ì…ë ¥í•´ì•¼ AI ê¸°ëŠ¥ì´ ì‘ë™í•´.<br>
  <a href="https://aistudio.google.com/apikey" target="_blank" style="color:var(--accent)">ğŸ‘‰ Google AI Studioì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ê¸°</a>
</div>
<div id="apiRow" class="api-row" style="display:none">
  <input id="apiKeyInp" class="api-inp" type="password" placeholder="AIza...ë¡œ ì‹œì‘í•˜ëŠ” í‚¤ ë¶™ì—¬ë„£ê¸°">
  <button class="api-save-btn" onclick="saveApiKey()">ì €ì¥</button>
</div>

<div class="tab-bar">
  <button class="tab-btn active" onclick="goTab('home')">í™ˆ</button>
  <button class="tab-btn" onclick="startCheck()">ì²´í¬í•˜ê¸°</button>
  <button class="tab-btn" onclick="goTab('memo')">ë‚˜ì˜ ê¸°ë¡</button>
</div>

<div class="inner">
  <div id="page-home" class="page active">
    <div class="hero">
      <div class="eyebrow">ë‚˜ì˜ ëŒì•„ì˜¤ëŠ” ì‹œìŠ¤í…œ</div>
      <h1>ê¸¸ì„ ìƒì—ˆì„ ë•Œ<br>ë‹¤ì‹œ ë‚˜ì—ê²Œ ëŒì•„ì˜¤ëŠ” ê³³</h1>
      <div class="motto">
        ì´ ì‹œìŠ¤í…œì€ ë‚˜ë¥¼ í†µì œí•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë‹¤.<br>
        ì™„ë²½í•˜ê²Œ ì§€í‚¤ì§€ ëª»í•´ë„ ëœë‹¤.<br>
        <strong>ì§€ê¸ˆ ì´ê±¸ ì—´ì—ˆë‹¤ëŠ” ê²ƒ ìì²´ê°€ ì´ë¯¸ ëŒì•„ì˜¤ëŠ” ì¤‘ì´ë‹¤.</strong>
      </div>
    </div>
    <div class="sec-lbl">ë‚´ê°€ ê²½í—˜ìœ¼ë¡œ ì•Œê²Œ ëœ ê²ƒë“¤</div>
    <div class="phil-list" id="philList"></div>
    <button class="start-btn" onclick="startCheck()">ì§€ê¸ˆ ë‚´ ìƒíƒœ í™•ì¸í•˜ê¸° â†’</button>
    <div style="height:32px"></div>
  </div>

  <div id="page-check" class="page">
    <div id="checkContent"></div>
  </div>

  <div id="page-memo" class="page">
    <div class="memo-h">
      <h2>ë‚˜ì˜ ê¸°ë¡</h2>
      <p class="memo-sub">ê²½í—˜ìœ¼ë¡œ ì•Œê²Œ ëœ ê²ƒë“¤ì„ ëª¨ì•„ë‘ëŠ” ê³³.<br>ì´ ê¸°ë¡ì´ ë§¤ë²ˆ AI ë¶„ì„ì— ë°˜ì˜ëœë‹¤.</p>
    </div>
    <div class="memo-add">
      <textarea id="newMemoTa" style="min-height:80px" placeholder="ì˜¤ëŠ˜ ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ê²ƒ, ë‚˜ì—ê²Œ íš¨ê³¼ ìˆì—ˆë˜ ê²ƒ, ëŠë‚€ ì ..."></textarea>
      <button class="memo-add-btn" onclick="addMemoFromId('newMemoTa')">ì €ì¥</button>
    </div>
    <div class="memo-list" id="memoList"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const BASE_PHIL = [
  {tag:"ì¤‘ì‹¬ ê°€ì¹˜",title:"í–‰ë³µí•˜ê²Œ ì‚´ì",body:"ì›í•˜ëŠ” ëŒ€ë¡œë§Œ ì‚´ì•„ë´¤ë”ë‹ˆ ìƒê°ë³´ë‹¤ í–‰ë³µí•˜ì§€ ì•Šì•˜ë‹¤. í•œë‘ ë‹¬ í•´ë³´ë‹ˆ ë‚˜ê°€ëŠ” ì¼ì´ ì—†ì„ìˆ˜ë¡ ëª¸ì´ ë§ê°€ì§€ê³  í”¼ê³¤í•´ì¡Œë‹¤. ì§ì ‘ ê²ªì–´ì„œ ì•Œê²Œ ëë‹¤. ì–´ì°¨í”¼ ì‚´ ê±°ë¼ë©´ í–‰ë³µí•˜ê²Œ ì‚´ê² ë‹¤."},
  {tag:"ê°€ì§œ ë³´ìƒ",title:"ëŒë¦°ë‹¤ê³  ì§„ì§œ ì›í•˜ëŠ” ê²Œ ì•„ë‹ ìˆ˜ ìˆë‹¤",body:"ì „ìê¸°ê¸°ë¥¼ ì˜¤ë˜ í•´ë´¤ë‹¤. ëì€ í•­ìƒ ëª¸ì´ ì•„í”„ê±°ë‚˜ ë” ìš°ìš¸í–ˆë‹¤. í•˜ì§€ ë§ë¼ê³  í•˜ë‹ˆê¹Œ ìŠ¤íŠ¸ë ˆìŠ¤, íšŒí”¼, ë³´ìƒ ì‹¬ë¦¬ë¡œ í•˜ê³  ìˆì—ˆë˜ ê²ƒì´ë‹¤. ì§ì ‘ í•´ë´¤ì„ ë•Œ ëì´ ì–´ë• ëŠ”ì§€ê°€ ê¸°ì¤€ì´ë‹¤."},
  {tag:"ìƒê°ì˜ ì‹¤ì²´",title:"êº¼ë‚´ì•¼ ì‹¤ì²´ê°€ ìƒê¸´ë‹¤",body:"ë¨¸ë¦¿ì†ì—ì„œ ë…¼ë¬¸ì²˜ëŸ¼ ëŠê»´ì§€ëŠ” ìƒê°ë„ êº¼ë‚´ë³´ë©´ ë‘ ì¤„ì´ ëœë‹¤. ì‹¤ë§ì´ ì•„ë‹ˆë‹¤. ì‹¤ì²´ê°€ ìƒê¸´ ê²ƒì´ë‹¤. ì‹¤ì²´ê°€ ìˆì–´ì•¼ ë‹¤ë£° ìˆ˜ ìˆë‹¤."},
  {tag:"ë¶ˆì•ˆ",title:"ë¶ˆì•ˆì€ ë¯¸ë˜ì— ìˆê³ , ë‚˜ëŠ” ì§€ê¸ˆ ì—¬ê¸° ìˆë‹¤",body:"ê±±ì •ì˜ 99%ëŠ” ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ë¯¸ë˜ë¥¼ ê±±ì •í•˜ë©° ì“°ëŠ” ì—ë„ˆì§€ë¡œ ì°¨ë¼ë¦¬ ì§€ê¸ˆ í•  ìˆ˜ ìˆëŠ” ê²ƒì— ì“°ëŠ” ê²Œ ë‚«ë‹¤."},
  {tag:"ë‚˜ë¥¼ ëŒ€í•˜ëŠ” ë°©ì‹",title:"ë‚˜ëŠ” í‰ìƒ ë‚˜ì™€ í•¨ê»˜ ì‚°ë‹¤",body:"ì•„ì´ëŒ ë§¤ë‹ˆì €ì²˜ëŸ¼ ëƒ‰ì² í•˜ê²Œ íŒŒì•…í•˜ë˜, ê·¸ ì •ë³´ëŠ” ë‚˜ë¥¼ ë°œì „ì‹œí‚¤ëŠ” ë° ì“´ë‹¤. ë¶€ì¡±í•œ ì ì€ ë‚˜ë¥¼ ê³µê²©í•˜ê¸° ìœ„í•œ ê²Œ ì•„ë‹ˆë¼ ì„±ì¥ì‹œí‚¤ê¸° ìœ„í•´ ìˆëŠ” ê²ƒì´ë‹¤."},
  {tag:"ë…¸ë ¥",title:"ë…¸ë ¥ì€ ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤",body:"ì•ˆ ì¢‹ì€ ì¼ì´ ìƒê¸°ê±°ë‚˜ ë‹¹ì¥ ë³€í™”ê°€ ì—†ì–´ë„ ìŒ“ì´ê³  ìˆë‹¤. ì¹˜ì—´í•˜ê²Œ 1ë¶„ 1ì´ˆ ê³ ë¯¼í•˜ëŠ” ê²ƒë„ ë‚˜ë¥¼ ì„±ì¥ì‹œí‚¤ê³  ìˆë‹¤."},
];

const SYS = `ë„ˆëŠ” ì´ ì‚¬ëŒì˜ ìƒíƒœë¥¼ íŒŒì•…í•˜ê³ , ì§€ê¸ˆ í•„ìš”í•œ ê²ƒì„ ì§šì–´ì£¼ëŠ” ì—­í• ì´ë‹¤.
ì•„ë˜ëŠ” ì´ ì‚¬ëŒì´ ì§ì ‘ ê²½í—˜ìœ¼ë¡œ ì–»ì€ ê°€ì¹˜ê´€ì´ë‹¤. ì´ê²ƒì„ ì™„ì „íˆ ì´í•´í•˜ê³  ë‹µë³€ì˜ ê·¼ê±°ë¡œ ì‚¼ì•„ë¼.

[ê²½í—˜ìœ¼ë¡œ ì–»ì€ ê°€ì¹˜ê´€]
1. í–‰ë³µì´ ì¤‘ì‹¬: ì›í•˜ëŠ” ëŒ€ë¡œë§Œ ì‚´ì•„ë´¤ë”ë‹ˆ í–‰ë³µí•˜ì§€ ì•Šì•˜ë‹¤. ì „ìê¸°ê¸° 10ì‹œê°„ ì´ìƒì€ í•­ìƒ ëª¸ì´ ë§ê°€ì§€ê³  ë” ìš°ìš¸í•´ì§€ëŠ” ê²ƒìœ¼ë¡œ ëë‚¬ë‹¤. ì§ì ‘ ê²ªì–´ì„œ ì•Œê²Œ ëë‹¤.
2. ê°€ì§œ ë³´ìƒ: ëŒë¦°ë‹¤ê³  ì§„ì§œ ì›í•˜ëŠ” ê²Œ ì•„ë‹ ìˆ˜ ìˆë‹¤. ìŠ¤íŠ¸ë ˆìŠ¤ íšŒí”¼ ì–µì••ì˜ ë°˜ë™ìœ¼ë¡œ ëŒë¦¬ëŠ” ê²½ìš°ê°€ ë§ë‹¤. ì§ì ‘ í•´ë´¤ì„ ë•Œ ëì´ ì–´ë• ëŠ”ì§€ê°€ ê¸°ì¤€ì´ë‹¤.
3. ìƒê°ì˜ ì‹¤ì²´: ë¨¸ë¦¿ì†ì—ì„œ ë…¼ë¬¸ì²˜ëŸ¼ ëŠê»´ì§€ëŠ” ìƒê°ë„ êº¼ë‚´ë³´ë©´ ë‘ ì¤„ë¡œ ì •ë¦¬ëœë‹¤. êº¼ë‚´ëŠ” ê²ƒ ìì²´ê°€ í•´ê²°ì˜ ì ˆë°˜ì´ë‹¤.
4. ë¶ˆì•ˆ: ê±±ì •ì˜ 99%ëŠ” ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ ì—ë„ˆì§€ë¥¼ ì§€ê¸ˆ í•  ìˆ˜ ìˆëŠ” ê²ƒì— ì“°ëŠ” ê²Œ ë‚«ë‹¤.
5. ë‚˜ë¥¼ ëŒ€í•˜ëŠ” ë°©ì‹: ë§¤ë‹ˆì €ì²˜ëŸ¼ ëƒ‰ì² í•˜ê²Œ ë¶„ì„í•˜ë˜ ê·¸ ì •ë³´ëŠ” ë°œì „ì„ ìœ„í•´ ì“´ë‹¤. ë‚˜ë¥¼ ê³µê²©í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë‹¤.
6. ë…¸ë ¥: ë…¸ë ¥ì€ ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤. ë‹¹ì¥ ë³€í™”ê°€ ì—†ì–´ë„ ìŒ“ì´ê³  ìˆë‹¤.

[ì›ì¹™]
- ìƒˆë¡œìš´ ê²ƒì„ ê°€ë¥´ì¹˜ê±°ë‚˜ ê°•ìš”í•˜ì§€ ë§ ê²ƒ. ì´ë¯¸ ì•„ëŠ” ì‚¬ëŒì´ë‹¤.
- ë”°ëœ»í•˜ì§€ë§Œ í˜„ì‹¤ì ìœ¼ë¡œ. í•œêµ­ì–´. ì§§ê³  ëª…í™•í•˜ê²Œ. êµ¬ì–´ì²´.
- ì´ ì‚¬ëŒì˜ ê°€ì¹˜ê´€ì„ ê·¼ê±°ë¡œ ëŒ€ë‹µí•  ê²ƒ. ì¼ë°˜ë¡ ì ì¸ ë§ì€ ì“°ì§€ ë§ ê²ƒ.
- í–‰ë™ê°•ë ¹ì€ ì§€ê¸ˆ ìƒíƒœì— ë§ê²Œ êµ¬ì²´ì ìœ¼ë¡œ. ë§‰ì—°í•œ ë§ ê¸ˆì§€.`;

let API_KEY = localStorage.getItem('gemini_key') || '';
let memos = JSON.parse(localStorage.getItem('memos_v4') || '[]');
let philCards = JSON.parse(localStorage.getItem('phil_cards') || 'null') || BASE_PHIL;

// ì²´í¬ ìƒíƒœ
let questions = [];
let curQ = 0;
let answers = {};
let generatingFollowUps = false;

window.onload = () => { checkApiKey(); renderPhil(); renderMemos(); };

function checkApiKey() {
  if (!API_KEY) {
    document.getElementById('apiBanner').style.display = 'block';
    document.getElementById('apiRow').style.display = 'flex';
  }
}
function saveApiKey() {
  const v = document.getElementById('apiKeyInp').value.trim();
  if (!v) return;
  API_KEY = v;
  localStorage.setItem('gemini_key', v);
  document.getElementById('apiBanner').style.display = 'none';
  document.getElementById('apiRow').style.display = 'none';
  showToast('API í‚¤ ì €ì¥ëë‹¤');
}

function goTab(tab) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + tab).classList.add('active');
  ['home','check','memo'].forEach((t,i) => {
    if (t===tab) document.querySelectorAll('.tab-btn')[i].classList.add('active');
  });
}

function renderPhil() {
  document.getElementById('philList').innerHTML = philCards.map(p => `
    <div class="phil-card">
      <div class="phil-tag">${p.tag}</div>
      <div class="phil-title">${p.title}</div>
      <div class="phil-body">${p.body}</div>
    </div>`).join('');
}

// â”€â”€ ì²´í¬ ì‹œì‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startCheck() {
  curQ = 0;
  answers = {};
  generatingFollowUps = false;
  questions = [
    {id:'mood', cat:'ì§€ê¸ˆ ìƒíƒœ', text:'ì§€ê¸ˆ ì „ë°˜ì ì¸ ê¸°ë¶„ì´ë‚˜ ìƒíƒœë¥¼ í•œ ë§ˆë””ë¡œ í‘œí˜„í•˜ë©´?',
     sub:'ì¢‹ë‹¤, ë¬´ê¸°ë ¥í•˜ë‹¤, ë¶ˆì•ˆí•˜ë‹¤, ëª¨ë¥´ê² ë‹¤ ë“± ë­ë“  ê´œì°®ì•„.', type:'ta',
     ins:'ë§ë¡œ êº¼ë‚´ëŠ” ê²ƒ ìì²´ê°€ ì´ë¯¸ ì ˆë°˜ì´ë‹¤.'},
    {id:'body', cat:'ëª¸ ìƒíƒœ', text:'ì§€ê¸ˆ ëª¸ ìƒíƒœëŠ” ì–´ë•Œ?',
     sub:'ì ì€ ì¶©ë¶„íˆ ì¤ëŠ”ì§€, í”¼ê³¤í•œì§€, ì–´ë”˜ê°€ ì•„í”ˆì§€.',
     type:'opts',
     opts:['ì „ë°˜ì ìœ¼ë¡œ ê´œì°®ë‹¤','ì¢€ í”¼ê³¤í•˜ê±°ë‚˜ ì°Œë¿Œë‘¥í•˜ë‹¤','ëšœë ·í•˜ê²Œ ì•ˆ ì¢‹ë‹¤'],
     ins:{
       'ì „ë°˜ì ìœ¼ë¡œ ê´œì°®ë‹¤':'ëª¸ì´ ë°›ì³ì¤„ ë•Œë‹¤. ëª¸ì´ ë˜ëŠ” ë‚  í•  ìˆ˜ ìˆëŠ” ê²ƒì´ ë‹¬ë¼ì§„ë‹¤.',
       'ì¢€ í”¼ê³¤í•˜ê±°ë‚˜ ì°Œë¿Œë‘¥í•˜ë‹¤':'ì§€ê¸ˆ ëŠë¼ëŠ” ê²ƒì˜ ì¼ë¶€ê°€ ëª¸ì—ì„œ ì˜¤ëŠ” ê²ƒì¼ ìˆ˜ ìˆë‹¤. ëª¸ê³¼ ë§ˆìŒì€ ì´ì–´ì ¸ ìˆë‹¤.',
       'ëšœë ·í•˜ê²Œ ì•ˆ ì¢‹ë‹¤':'ëª¸ì´ ë¨¼ì €ë‹¤. ëª¸ì´ ë§ê°€ì§„ ì±„ë¡œ ì–µì§€ë¡œ í•˜ëŠ” ê±´ íš¨ìœ¨ì´ ì—†ë‹¤ëŠ” ê±¸ ê²½í—˜ìœ¼ë¡œ ì•Œì§€.'
     }},
    {id:'avoidance', cat:'í–‰ë™ íŒ¨í„´', text:'ì§€ê¸ˆ ì˜¤ë˜ ë§¤ë‹¬ë¦¬ê³  ìˆê±°ë‚˜ í”¼í•˜ê³  ìˆëŠ” ê²Œ ìˆì–´?',
     sub:'ì „ìê¸°ê¸°, í•´ì•¼ í•  ì¼, íŠ¹ì • ìƒê° ë“±. ìˆë‹¤ë©´ ë­”ì§€, ì–¼ë§ˆë‚˜ ëëŠ”ì§€ë„.',
     type:'ta',
     ins:'ëŒë¦°ë‹¤ê³  ì›í•˜ëŠ” ê²Œ ì•„ë‹ ìˆ˜ ìˆë‹¤. ì§ì ‘ í•´ë´¤ì„ ë•Œ ëì´ ì–´ë• ëŠ”ì§€ ê¸°ì–µí•˜ë©´ ë‹µì´ ë‚˜ì˜¨ë‹¤.'},
    {id:'anxiety', cat:'ë¶ˆì•ˆÂ·ê±±ì •', text:'ì§€ê¸ˆ ë¨¸ë¦¿ì†ì„ ë§´ë„ëŠ” ê±±ì •ì´ë‚˜ ë¶ˆì•ˆí•œ ìƒê°ì´ ìˆì–´?',
     sub:'ìˆë‹¤ë©´ êº¼ë‚´ë³´ì. ë¨¸ë¦¿ì†ì— ë‘ë©´ ê³„ì† ê±°ëŒ€í•´ì§„ë‹¤.',
     type:'ta',
     ins:'ê±±ì •ì˜ 99%ëŠ” ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤. êº¼ë‚´ë³´ë©´ ìƒê°ë³´ë‹¤ ë‹¨ìˆœí•œ ê²½ìš°ê°€ ë§ë‹¤.'},
  ];
  goTab('check');
  renderQ();
}

// â”€â”€ ì§ˆë¬¸ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderQ() {
  const q = questions[curQ];
  const pct = Math.round((curQ / Math.max(questions.length, 1)) * 100);
  const isLast = curQ === questions.length - 1 && !generatingFollowUps;

  let html = `
    <div class="q-header">
      <div class="prog-row">
        <div class="prog-bar"><div class="prog-fill" style="width:${pct}%"></div></div>
        <div class="prog-lbl">${curQ+1} / ${questions.length}</div>
      </div>
      <div class="q-cat">${q.cat}</div>
      <div class="q-text">${q.text}</div>
      <div class="q-sub">${q.sub}</div>
    </div>`;

  if (q.type === 'opts') {
    html += `<div class="opts">` + q.opts.map(o =>
      `<button class="opt-btn${answers[q.id]===o?' selected':''}" onclick="selectOpt(this,'${o}')">${o}</button>`
    ).join('') + `</div>`;
    if (q.ins && answers[q.id]) {
      html += `<div class="insight-box"><div class="insight-lbl">ì´ëŸ° ìƒê°ì´ ë“ ë‹¤</div><div class="insight-txt">${q.ins[answers[q.id]]}</div></div>`;
    }
  } else {
    // ta íƒ€ì…: oninputìœ¼ë¡œ ì‹¤ì‹œê°„ ì €ì¥ + ë²„íŠ¼ í™œì„±í™”
    const escaped = (answers[q.id]||'').replace(/'/g,"&#39;");
    html += `<div class="ta-wrap">
      <textarea id="taMain" placeholder="ì—¬ê¸°ì— ê·¸ëƒ¥ ë±‰ì–´ë³´ì. ì˜ ì“°ë ¤ê³  í•˜ì§€ ì•Šì•„ë„ ëœë‹¤."
        oninput="onTaInput(this)">${escaped}</textarea>
    </div>`;
    if (q.ins && (answers[q.id]||'').trim().length > 2) {
      html += `<div class="insight-box"><div class="insight-lbl">ì´ëŸ° ìƒê°ì´ ë“ ë‹¤</div><div class="insight-txt">${q.ins}</div></div>`;
    }
  }

  const hasAns = q.type==='opts' ? !!answers[q.id] : (answers[q.id]||'').trim().length > 0;
  html += `<div class="nav-row">
    ${curQ > 0 ? `<button class="btn-back" onclick="prevQ()">â†</button>` : ''}
    <button class="btn-next" id="btnNext" onclick="nextQ()" ${hasAns?'':'disabled'}>
      ${isLast ? 'ì‹¬í™” ì§ˆë¬¸ ìƒì„± â†’' : curQ >= questions.length-1 ? 'ê²°ê³¼ ë³´ê¸°' : 'ë‹¤ìŒ'}
    </button>
  </div>`;

  document.getElementById('checkContent').innerHTML = html;
}

// ta ì…ë ¥ ì‹¤ì‹œê°„ ë°˜ì˜
function onTaInput(el) {
  const q = questions[curQ];
  answers[q.id] = el.value;
  const btn = document.getElementById('btnNext');
  if (btn) btn.disabled = el.value.trim().length === 0;
  // ì¸ì‚¬ì´íŠ¸ ë°•ìŠ¤ í† ê¸€ (ì¬ë Œë” ì—†ì´)
  const existing = document.querySelector('.insight-box');
  if (q.ins && el.value.trim().length > 2 && !existing) {
    const insHtml = `<div class="insight-box"><div class="insight-lbl">ì´ëŸ° ìƒê°ì´ ë“ ë‹¤</div><div class="insight-txt">${q.ins}</div></div>`;
    document.querySelector('.ta-wrap').insertAdjacentHTML('afterend', insHtml);
  }
}

function selectOpt(btn, val) {
  const q = questions[curQ];
  answers[q.id] = val;
  document.querySelectorAll('.opt-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  document.getElementById('btnNext').disabled = false;
  // ì¸ì‚¬ì´íŠ¸
  const existing = document.querySelector('.insight-box');
  if (existing) existing.remove();
  const insHtml = `<div class="insight-box"><div class="insight-lbl">ì´ëŸ° ìƒê°ì´ ë“ ë‹¤</div><div class="insight-txt">${q.ins[val]}</div></div>`;
  document.querySelector('.opts').insertAdjacentHTML('afterend', insHtml);
}

function prevQ() { if(curQ>0){curQ--;renderQ();} }

async function nextQ() {
  // í˜„ì¬ê°€ ë§ˆì§€ë§‰ ê¸°ë³¸ ì§ˆë¬¸ì´ê³  ì•„ì§ ì‹¬í™” ì•ˆ ë§Œë“¤ì—ˆìœ¼ë©´ â†’ ìƒì„±
  if (curQ === questions.length - 1 && !generatingFollowUps) {
    generatingFollowUps = true;
    await generateFollowUps();
    return;
  }
  if (curQ < questions.length - 1) {
    curQ++;
    renderQ();
  } else {
    showResult();
  }
}

// â”€â”€ ì‹¬í™” ì§ˆë¬¸ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function generateFollowUps() {
  document.getElementById('checkContent').innerHTML = `
    <div style="padding:50px 22px;text-align:center">
      <div class="spinner-lg" style="margin-bottom:16px"></div>
      <div style="font-size:13px;color:var(--textF)">ë„¤ ìƒíƒœ íŒŒì•…í•˜ê³  ì‹¬í™” ì§ˆë¬¸ ë§Œë“œëŠ” ì¤‘...</div>
    </div>`;

  const ctx = questions.map(q => `[${q.text}]\n${answers[q.id]||'(ë¯¸ì‘ë‹µ)'}`).join('\n\n');
  const memCtx = memos.length > 0 ? `\n\n[ì´ì „ ê¸°ë¡]\n${memos.slice(0,5).map(m=>m.text).join('\n')}` : '';

  const prompt = `ë‹¤ìŒì€ ì‚¬ìš©ìê°€ ë‹µí•œ ì´ˆê¸° ìƒíƒœ ì²´í¬ ë‚´ìš©ì´ë‹¤:\n${ctx}${memCtx}\n\nì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ìƒíƒœë¥¼ ë” ê¹Šì´ íŒŒì•…í•˜ê¸° ìœ„í•œ ì‹¬í™” ì§ˆë¬¸ 2~3ê°œë¥¼ ë§Œë“¤ì–´ë¼.\n\nê·œì¹™:\n- ì´ë¯¸ ë‹µí•œ ë‚´ìš©ì„ ë‹¤ì‹œ ë¬»ì§€ ë§ ê²ƒ\n- ë‹µë³€ì—ì„œ ì–¸ê¸‰ëœ êµ¬ì²´ì ì¸ ê²ƒì„ íŒŒê³ ë“¤ ê²ƒ\n- ì§§ê³  êµ¬ì–´ì²´ë¡œ\n- JSON ë°°ì—´ë¡œë§Œ ì¶œë ¥. ê° í•­ëª©: {"id":"fu1","cat":"ì¹´í…Œê³ ë¦¬","text":"ì§ˆë¬¸","sub":"ë³´ì¡°ì„¤ëª…"}\n- ë‹¤ë¥¸ í…ìŠ¤íŠ¸ ì—†ì´ JSONë§Œ ì¶œë ¥`;

  try {
    const txt = await callGemini(prompt, 400);
    const clean = txt.replace(/```json|```/g,'').trim();
    const parsed = JSON.parse(clean);
    parsed.forEach(q => { q.type = 'ta'; q.ins = 'êº¼ë‚´ë³´ë©´ ìƒê°ë³´ë‹¤ ë‹¨ìˆœí•œ ê²½ìš°ê°€ ë§ë‹¤.'; questions.push(q); });
  } catch(e) {
    // ì‹¤íŒ¨í•´ë„ ê²°ê³¼ë¡œ ë„˜ì–´ê°
  }

  curQ++;
  if (curQ < questions.length) renderQ();
  else showResult();
}

// â”€â”€ ê²°ê³¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showResult() {
  const now = new Date();
  const timeStr = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')} ${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;

  document.getElementById('checkContent').innerHTML = `
    <div class="res-top"><h2>ì§€ê¸ˆ ë‚˜ì˜ ìƒíƒœ</h2><div class="res-time">${timeStr}</div></div>
    <div class="res-sec"><div class="res-sec-t">ë‚´ê°€ í•œ ë§ ê·¸ëŒ€ë¡œ</div><div id="summaryRows"></div></div>
    <div class="res-sec"><div class="res-sec-t">ì§€ê¸ˆ ë‚˜ë¥¼ ì½ì–´ë³´ë©´</div><div class="ai-box" id="analysisBox"><div class="spinner-lg" style="padding:8px 0"></div></div></div>
    <div class="res-sec"><div class="res-sec-t">ì§€ê¸ˆ ë‹¹ì¥ í•  ê²ƒ (ë§ì¶¤í˜•)</div><div id="actionsBox"><div class="ai-box"><div class="spinner-lg" style="padding:8px 0"></div></div></div></div>
    <div class="memo-save-area">
      <div class="res-sec-t" style="margin-top:0">ì˜¤ëŠ˜ì˜ ë©”ëª¨</div>
      <div class="memo-lbl">ì˜¤ëŠ˜ ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ê²ƒì´ë‚˜ ëŠë‚€ ì .<br>ì´ ê¸°ë¡ì´ ë‹¤ìŒ ë¶„ì„ì— ë°˜ì˜ëœë‹¤.</div>
      <textarea id="resMemoTa" style="min-height:70px;margin-top:8px" placeholder="ì˜¤ëŠ˜ì˜ ê¹¨ë‹¬ìŒ..."></textarea>
      <button class="save-m-btn" onclick="addMemoFromId('resMemoTa')">ê¸°ë¡ì— ì €ì¥</button>
    </div>
    <div class="final-box"><p>ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.<br><strong>ì´ê±¸ ì—´ì—ˆë‹¤ëŠ” ê²ƒ ìì²´ê°€ ì´ë¯¸ ëŒì•„ì˜¤ëŠ” ì¤‘ì´ë‹¤.</strong></p></div>
    <button class="restart-btn" onclick="startCheck()">ì²˜ìŒë¶€í„° ë‹¤ì‹œ</button>
    <div style="height:28px"></div>`;

  renderSummaryRows();
  runAnalysis();
}

function renderSummaryRows() {
  const rows = questions
    .filter(q => answers[q.id] && answers[q.id].trim())
    .map(q => {
      const val = answers[q.id];
      const dot = q.id==='body'
        ? (val==='ì „ë°˜ì ìœ¼ë¡œ ê´œì°®ë‹¤'?'ok':val==='ì¢€ í”¼ê³¤í•˜ê±°ë‚˜ ì°Œë¿Œë‘¥í•˜ë‹¤'?'warn':'bad')
        : 'warn';
      return `<div class="s-row">
        <div class="dot ${dot}"></div>
        <div><div class="s-lbl">${q.text}</div><div class="s-val">${val}</div></div>
      </div>`;
    }).join('');
  document.getElementById('summaryRows').innerHTML = rows;
}

async function runAnalysis() {
  const ctx = questions
    .filter(q => answers[q.id] && answers[q.id].trim())
    .map(q => `[${q.text}]\n${answers[q.id]}`).join('\n\n');
  const memCtx = memos.length > 0 ? `\n\n[ì´ ì‚¬ëŒì˜ ì´ì „ ê¸°ë¡/ê¹¨ë‹¬ìŒ]\n${memos.slice(0,5).map(m=>m.text).join('\n')}` : '';

  const prompt = `ë‹¤ìŒì€ ì˜¤ëŠ˜ì˜ ìƒíƒœ ì²´í¬ ê²°ê³¼ë‹¤:\n\n${ctx}${memCtx}\n\në‘ ê°€ì§€ë¥¼ ì‘ì„±í•˜ë¼:\n\n[ì§€ê¸ˆ ë‚˜ë¥¼ ì½ì–´ë³´ë©´]\nì§€ê¸ˆ ì´ ì‚¬ëŒì˜ ìƒíƒœë¥¼ 2~3ë¬¸ì¥ìœ¼ë¡œ. í‰ê°€ ì—†ì´, ë³´ì´ëŠ” ê²ƒì„ ê·¸ëŒ€ë¡œ. ì´ ì‚¬ëŒì´ ì§ì ‘ ì“´ í‘œí˜„ì„ ì‚´ë ¤ì„œ ë°˜ì˜í•  ê²ƒ.\n\n[ì§€ê¸ˆ ë‹¹ì¥ í•  ê²ƒ]\nì§€ê¸ˆ ì´ ìƒíƒœì— ë”± ë§ëŠ” êµ¬ì²´ì ì¸ í–‰ë™ 3ê°€ì§€. ì´ ì‚¬ëŒì˜ ê°€ì¹˜ê´€ì„ ì´ìœ ë¡œ ì œì‹œí•  ê²ƒ. 'ê°€ì¹˜ê´€ì„ ë– ì˜¬ë¦¬ì' 'ë¶„ë¥˜í•˜ì' ê°™ì€ ì¶”ìƒì  í–‰ë™ ê¸ˆì§€.\ní˜•ì‹:\n1. í–‰ë™ ì œëª©\nì´ìœ : ì´ ì‚¬ëŒì˜ ê°€ì¹˜ê´€ ì¤‘ ì–´ë–¤ ê²ƒì— ê·¼ê±°í•˜ëŠ”ì§€ í•œ ì¤„\nêµ¬ì²´ì ìœ¼ë¡œ: ì§€ê¸ˆ ë°”ë¡œ í•  ìˆ˜ ìˆëŠ” ê²ƒ`;

  try {
    const text = await callGemini(prompt, 900);
    const am = text.match(/\[ì§€ê¸ˆ ë‚˜ë¥¼ ì½ì–´ë³´ë©´\]([\s\S]*?)(?=\[ì§€ê¸ˆ ë‹¹ì¥ í•  ê²ƒ\]|$)/);
    const acm = text.match(/\[ì§€ê¸ˆ ë‹¹ì¥ í•  ê²ƒ\]([\s\S]*?)$/);

    document.getElementById('analysisBox').textContent = am ? am[1].trim() : text;

    if (acm) {
      const lines = acm[1].trim().split('\n');
      let acts = [], cur = null;
      lines.forEach(line => {
        const l = line.trim();
        if (/^\d+\./.test(l)) {
          if (cur) acts.push(cur);
          cur = {title:l.replace(/^\d+\.\s*/,''), why:'', how:''};
        } else if (l.startsWith('ì´ìœ :') && cur) cur.why = l.replace('ì´ìœ :','').trim();
        else if (l.startsWith('êµ¬ì²´ì ìœ¼ë¡œ:') && cur) cur.how = l.replace('êµ¬ì²´ì ìœ¼ë¡œ:','').trim();
      });
      if (cur) acts.push(cur);
      document.getElementById('actionsBox').innerHTML = acts.map((a,i) => `
        <div class="act-card">
          <div class="act-top"><div class="act-num">${i+1}</div><div class="act-title">${a.title}</div></div>
          ${a.why?`<div class="act-why">ì™œ: ${a.why}</div>`:''}
          ${a.how?`<div class="act-desc">â†’ ${a.how}</div>`:''}
        </div>`).join('');
    }
  } catch(e) {
    document.getElementById('analysisBox').textContent = 'API í‚¤ë¥¼ í™•ì¸í•´ë´. ' + e.message;
    document.getElementById('actionsBox').innerHTML = '';
  }
}

// â”€â”€ Gemini API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callGemini(prompt, maxTokens=600) {
  if (!API_KEY) throw new Error('API í‚¤ ì—†ìŒ');
  const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${API_KEY}`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({
      contents:[{parts:[{text: SYS + '\n\n' + prompt}]}],
      generationConfig:{maxOutputTokens:maxTokens, temperature:0.7}
    })
  });
  const d = await res.json();
  if (d.error) throw new Error(d.error.message);
  return d.candidates?.[0]?.content?.parts?.[0]?.text || '';
}

// â”€â”€ ë©”ëª¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addMemoFromId(taId) {
  const el = document.getElementById(taId);
  if (!el || !el.value.trim()) return;
  memos = [{id:Date.now(), text:el.value.trim(), date:new Date().toLocaleDateString('ko-KR')}, ...memos];
  localStorage.setItem('memos_v4', JSON.stringify(memos));
  el.value = '';
  renderMemos();
  showToast('ì €ì¥ëë‹¤');
}
function deleteMemo(id) {
  memos = memos.filter(m=>m.id!==id);
  localStorage.setItem('memos_v4', JSON.stringify(memos));
  renderMemos();
}
function renderMemos() {
  const el = document.getElementById('memoList');
  if (!el) return;
  el.innerHTML = memos.length === 0
    ? `<div class="memo-empty">ì•„ì§ ê¸°ë¡ì´ ì—†ë‹¤.<br>ì˜¤ëŠ˜ ëŠë‚€ ê²ƒ í•œ ì¤„ì´ë¼ë„ ë‚¨ê²¨ë‘ì.</div>`
    : memos.map(m=>`
      <div class="memo-item">
        <div class="memo-date">${m.date}</div>
        <div class="memo-text">${m.text}</div>
        <button class="memo-del" onclick="deleteMemo(${m.id})">Ã—</button>
      </div>`).join('');
}

function showToast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'), 2000);
}
</script>
</body>
</html>